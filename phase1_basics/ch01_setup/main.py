"""
Chapter 01 - FastAPI Hello World
================================
FastAPI의 기본 구조를 이해하기 위한 첫 번째 예제.
루트("/"), 인사("/hello/{name}"), 헬스체크("/health") 엔드포인트를 구현한다.
"""

from fastapi import FastAPI

# ============================================================
# FastAPI 앱 인스턴스 생성
# ============================================================
# title: Swagger UI 상단에 표시되는 API 제목
# description: API에 대한 설명 (마크다운 지원)
# version: API 버전 정보
app = FastAPI(
    title="Chapter 01 - Hello FastAPI",
    description="FastAPI 입문을 위한 Hello World 예제 API",
    version="1.0.0",
)


# ============================================================
# 루트 엔드포인트
# ============================================================
# @app.get("/") → HTTP GET 메서드로 "/" 경로에 대한 핸들러를 등록한다.
# 데코레이터에 지정된 경로로 요청이 들어오면 아래 함수가 실행된다.
# 딕셔너리를 반환하면 FastAPI가 자동으로 JSON 응답으로 변환한다.
@app.get(
    "/",
    summary="루트 엔드포인트",
    description="서버가 정상적으로 동작하는지 확인하기 위한 기본 엔드포인트이다.",
    tags=["기본"],
)
def read_root():
    """
    루트 경로에 접속하면 환영 메시지를 반환한다.
    딕셔너리를 리턴하면 FastAPI가 자동으로 JSON으로 직렬화한다.
    """
    return {
        "message": "안녕하세요! FastAPI에 오신 것을 환영합니다.",
        "docs": "http://127.0.0.1:8000/docs 에서 API 문서를 확인하세요.",
    }


# ============================================================
# Path 파라미터를 사용하는 인사 엔드포인트
# ============================================================
# 경로에 {name}처럼 중괄호로 감싸면 Path 파라미터가 된다.
# 함수 매개변수 이름(name)이 경로의 중괄호 이름과 일치해야 한다.
# 타입 힌트(str)를 지정하면 FastAPI가 자동으로 타입 검증을 수행한다.
@app.get(
    "/hello/{name}",
    summary="이름으로 인사하기",
    description="URL 경로에 이름을 포함하여 맞춤 인사 메시지를 반환한다.",
    tags=["인사"],
)
def say_hello(name: str):
    """
    Path 파라미터로 전달된 이름을 사용해 인사 메시지를 생성한다.

    - **name**: 인사할 대상의 이름 (문자열)

    예시: /hello/홍길동 → {"message": "안녕하세요, 홍길동님!"}
    """
    return {"message": f"안녕하세요, {name}님!"}


# ============================================================
# 헬스체크 엔드포인트
# ============================================================
# 서버 상태를 확인하기 위한 표준 패턴이다.
# 로드 밸런서, 모니터링 시스템에서 주기적으로 호출하여
# 서버가 정상 동작 중인지 판별하는 데 사용한다.
@app.get(
    "/health",
    summary="서버 상태 확인",
    description="서버의 현재 동작 상태를 확인하기 위한 헬스체크 엔드포인트이다.",
    tags=["시스템"],
)
def health_check():
    """
    서버가 정상적으로 동작 중이면 status: healthy를 반환한다.
    실무에서는 DB 연결, 외부 서비스 상태 등도 함께 확인하는 것이 일반적이다.
    """
    return {"status": "healthy", "message": "서버가 정상적으로 동작 중입니다."}


# ============================================================
# 직접 실행 시 uvicorn으로 서버를 시작한다.
# ============================================================
# 일반적으로는 터미널에서 `uvicorn main:app --reload`로 실행하지만,
# `python main.py`로도 실행할 수 있도록 아래 코드를 추가한다.
if __name__ == "__main__":
    import uvicorn

    uvicorn.run("main:app", host="127.0.0.1", port=8000, reload=True)
